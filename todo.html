---
layout: default
title: Todo List
permalink: /todo/
---
<div class="container">
    <div class="page-header">
        <h1>Todo List</h1>
        <p>Manage your tasks efficiently with this simple todo list application.</p>
    </div>

    <div class="todo-wrapper">
        <input type="text" id="todo-input" placeholder="Add a new task..." />
        <button id="add-todo-btn">Add Task</button>
    </div>

    <ul id="todo-list">
        <!-- Items dynamically added here -->
    </ul>

    <a href="https://joshalvarado.com/auth/google" id="login-btn">Sign in with Google</a>
    <button id="logout-btn" style="display:none;">Logout</button>
    <span id="user-info"></span>
</div>
<script>
    function showAuthUI(user) {
        if (user) {
            document.getElementById('login-btn').style.display = 'none';
            document.getElementById('logout-btn').style.display = 'inline-block';
            document.getElementById('user-info').textContent = `Signed in as ${user.name} (${user.email})`;
            document.querySelector('.todo-wrapper').style.display = '';
            document.getElementById('todo-list').style.display = '';
        } else {
            document.getElementById('login-btn').style.display = 'inline-block';
            document.getElementById('logout-btn').style.display = 'none';
            document.getElementById('user-info').textContent = '';
            document.querySelector('.todo-wrapper').style.display = 'none';
            document.getElementById('todo-list').style.display = 'none';
        }
    }

    // Check login status and load todos if logged in
    function checkAuthAndLoadTodos() {
        fetch('/api/user', { credentials: 'include' })
            .then(res => res.json())
            .then(data => {
                showAuthUI(data.user);
                if (data.user) loadTodos();
            });
    }

    // Load todos from API
    function loadTodos() {
        fetch('/api/todos', { credentials: 'include' })
            .then(res => {
                if (res.status === 401) {
                    showAuthUI(null);
                    return [];
                }
                return res.json();
            })
            .then(todos => {
                const todoList = document.getElementById('todo-list');
                todoList.innerHTML = '';
                todos.forEach((todo, idx) => {
                    const li = document.createElement('li');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = 'task' + idx;
                    checkbox.checked = todo.completed;
                    checkbox.addEventListener('change', () => {
                        fetch(`/api/todos/${idx}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ completed: checkbox.checked }),
                            credentials: 'include'
                        }).then(() => loadTodos());
                    });

                    const label = document.createElement('input');
                    label.type = 'text';
                    label.value = todo.text;
                    label.id = 'label' + idx;
                    label.addEventListener('change', () => {
                        fetch(`/api/todos/${idx}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ text: label.value }),
                            credentials: 'include'
                        }).then(() => loadTodos());
                    });

                    // Delete button
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.addEventListener('click', () => {
                        fetch(`/api/todos/${idx}`, {
                            method: 'DELETE',
                            credentials: 'include'
                        }).then(() => loadTodos());
                    });

                    li.appendChild(checkbox);
                    li.appendChild(label);
                    li.appendChild(deleteBtn);
                    todoList.appendChild(li);
                });
            });
    }

    // Add new todo via API
    document.getElementById('add-todo-btn').addEventListener('click', () => {
        const input = document.getElementById('todo-input');
        const text = input.value.trim();
        if (text) {
            fetch('/api/todos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, completed: false }),
                credentials: 'include'
            }).then(() => {
                input.value = '';
                loadTodos();
            });
        }
    });

    // Logout handler
    document.getElementById('logout-btn').addEventListener('click', function() {
        fetch('/logout', { credentials: 'include' }).then(() => window.location.reload());
    });

    // Initial load
    window.addEventListener('DOMContentLoaded', checkAuthAndLoadTodos);
</script>